name: Deploy Static Website to S3

on:
  push:
    branches:
      - main  # Trigger deployment on push to the main branch

jobs:
  deploy:
    runs-on: ubuntu-latest  # Use the latest Ubuntu runner

    steps:
      # Step 1: Checkout the code
      - name: Checkout code
        uses: actions/checkout@v2

      # Step 2: Set up AWS CLI using OIDC
      - name: Set up AWS CLI
        uses: aws-actions/configure-aws-credentials@v1
        with:
          role-to-assume: arn:aws:iam::248189921392:role/my-OIDC  # The ARN of the IAM role you created
          aws-region: ${{ secrets.AWS_REGION }}  # The AWS region where the bucket is located
          role-session-name: GitHubActionsSession  # A session name for the assumed role

      # Step 3: Sync files to S3 bucket
      - name: Sync files to S3 bucket
        run: |
          aws s3 sync ./ s3://vision-ads --delete --exclude ".git/*"  # Replace with your bucket name

      # Optional: Invalidate CloudFront cache (if using CloudFront)
      - name: Invalidate CloudFront cache
        run: |
          aws cloudfront create-invalidation --distribution-id ABCD1234XYZ --paths "/*"  # Replace with your distribution ID
